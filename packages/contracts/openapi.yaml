openapi: 3.0.3
info:
  title: Nebula Panel API
  version: 1.0.0
  description: REST API contract for Nebula Panel V1.
servers:
  - url: /v1
paths:
  /version:
    get:
      tags: [Meta]
      responses:
        '200': {description: OK}

  /auth/login:
    post:
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401': {description: Unauthorized}
  /auth/totp/verify:
    post:
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TOTPVerifyRequest'
      responses:
        '200': {description: OK}
        '401': {description: Unauthorized}
  /auth/logout:
    post:
      tags: [Auth]
      responses:
        '204': {description: No Content}
  /auth/me:
    get:
      tags: [Auth]
      security: [{ bearerAuth: [] }]
      responses:
        '200': {description: OK}

  /auth/totp/status:
    get:
      tags: [Auth]
      security: [{ bearerAuth: [] }]
      responses:
        '200': {description: OK}

  /auth/totp/enroll/start:
    post:
      tags: [Auth]
      security: [{ bearerAuth: [] }]
      responses:
        '200': {description: OK}

  /auth/totp/enroll/verify:
    post:
      tags: [Auth]
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [code]
              properties:
                code: {type: string}
      responses:
        '200': {description: OK}

  /auth/totp/disable:
    post:
      tags: [Auth]
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [code]
              properties:
                code: {type: string}
      responses:
        '200': {description: OK}

  /users:
    post:
      tags: [Users]
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema: {$ref: '#/components/schemas/CreateUserRequest'}
      responses:
        '201': {description: Created}
    get:
      tags: [Users]
      security: [{ bearerAuth: [] }]
      responses:
        '200': {description: OK}
  /users/{id}:
    patch:
      tags: [Users]
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: {type: string}
      responses:
        '200': {description: OK}
    delete:
      tags: [Users]
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: {type: string}
      responses:
        '204': {description: No Content}
  /users/{id}/sftp/rotate-password:
    post:
      tags: [Users]
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: {type: string}
      responses:
        '200': {description: OK}

  /sites:
    post:
      tags: [Sites]
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema: {$ref: '#/components/schemas/CreateSiteRequest'}
      responses:
        '201': {description: Created}
    get:
      tags: [Sites]
      security: [{ bearerAuth: [] }]
      responses:
        '200': {description: OK}
  /sites/{id}:
    get:
      tags: [Sites]
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: {type: string}
      responses:
        '200': {description: OK}
    delete:
      tags: [Sites]
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: {type: string}
      responses:
        '202': {description: Accepted}

  /sites/{id}/databases:
    post:
      tags: [Databases]
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: {type: string}
      responses:
        '201': {description: Created}
    get:
      tags: [Databases]
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: {type: string}
      responses:
        '200': {description: OK}
  /databases/{id}:
    delete:
      tags: [Databases]
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: {type: string}
      responses:
        '202': {description: Accepted}

  /sites/{id}/ssl/issue:
    post:
      tags: [SSL]
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: {type: string}
      responses:
        '202': {description: Accepted}
  /sites/{id}/ssl/renew:
    post:
      tags: [SSL]
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: {type: string}
      responses:
        '202': {description: Accepted}
  /sites/{id}/ssl/status:
    get:
      tags: [SSL]
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: {type: string}
      responses:
        '200': {description: OK}

  /dns/zones:
    post:
      tags: [DNS]
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [zone]
              properties:
                zone: {type: string}
      responses:
        '201': {description: Created}
    get:
      tags: [DNS]
      security: [{ bearerAuth: [] }]
      responses:
        '200': {description: OK}
  /dns/zones/{zone}:
    get:
      tags: [DNS]
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: zone
          required: true
          schema: {type: string}
      responses:
        '200': {description: OK}
    delete:
      tags: [DNS]
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: zone
          required: true
          schema: {type: string}
      responses:
        '202': {description: Accepted}
  /dns/zones/{zone}/records:
    put:
      tags: [DNS]
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: zone
          required: true
          schema: {type: string}
      responses:
        '200': {description: OK}
  /dns/zones/{zone}/records/{id}:
    delete:
      tags: [DNS]
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: zone
          required: true
          schema: {type: string}
        - in: path
          name: id
          required: true
          schema: {type: string}
      responses:
        '200': {description: OK}

  /files/tree:
    get:
      tags: [Files]
      security: [{ bearerAuth: [] }]
      responses:
        '200': {description: OK}
  /files/upload:
    post:
      tags: [Files]
      security: [{ bearerAuth: [] }]
      responses:
        '201': {description: Created}
  /files/mkdir:
    post:
      tags: [Files]
      security: [{ bearerAuth: [] }]
      responses:
        '201': {description: Created}
  /files/chmod:
    patch:
      tags: [Files]
      security: [{ bearerAuth: [] }]
      responses:
        '200': {description: OK}
  /files:
    delete:
      tags: [Files]
      security: [{ bearerAuth: [] }]
      responses:
        '204': {description: No Content}

  /mail/domains:
    post:
      tags: [Mail]
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [domain]
              properties:
                domain: {type: string}
      responses:
        '201': {description: Created}
    get:
      tags: [Mail]
      security: [{ bearerAuth: [] }]
      responses:
        '200': {description: OK}
  /mail/domains/{domain}/mailboxes:
    post:
      tags: [Mail]
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: domain
          required: true
          schema: {type: string}
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [local_part]
              properties:
                local_part: {type: string}
                password: {type: string}
                quota_mb: {type: integer}
      responses:
        '201': {description: Created}
    get:
      tags: [Mail]
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: domain
          required: true
          schema: {type: string}
      responses:
        '200': {description: OK}
  /mail/domains/{domain}/dns-auth:
    get:
      tags: [Mail]
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: domain
          required: true
          schema: {type: string}
      responses:
        '200': {description: OK}
  /mail/aliases:
    post:
      tags: [Mail]
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [domain, source, destination]
              properties:
                domain: {type: string}
                source: {type: string}
                destination: {type: string}
      responses:
        '201': {description: Created}
    get:
      tags: [Mail]
      security: [{ bearerAuth: [] }]
      parameters:
        - in: query
          name: domain
          required: false
          schema: {type: string}
      responses:
        '200': {description: OK}
  /mail/aliases/{id}:
    delete:
      tags: [Mail]
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: {type: string}
      responses:
        '202': {description: Accepted}
  /mail/mailboxes/{id}:
    delete:
      tags: [Mail]
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: {type: string}
      responses:
        '200': {description: OK}

  /webmail/session:
    post:
      tags: [Webmail]
      security: [{ bearerAuth: [] }]
      responses:
        '201': {description: Created}
  /webmail/folders:
    get:
      tags: [Webmail]
      security: [{ bearerAuth: [] }]
      responses:
        '200': {description: OK}
  /webmail/messages:
    get:
      tags: [Webmail]
      security: [{ bearerAuth: [] }]
      responses:
        '200': {description: OK}
  /webmail/messages/send:
    post:
      tags: [Webmail]
      operationId: sendWebmailMessage
      security: [{ bearerAuth: [] }]
      responses:
        '201': {description: Created}

  /backups/run:
    post:
      tags: [Backups]
      security: [{ bearerAuth: [] }]
      responses:
        '202': {description: Accepted}
  /backups:
    get:
      tags: [Backups]
      security: [{ bearerAuth: [] }]
      responses:
        '200': {description: OK}
  /backups/{id}:
    get:
      tags: [Backups]
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: {type: string}
      responses:
        '200': {description: OK}
  /backups/{id}/restore:
    post:
      tags: [Backups]
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: {type: string}
      responses:
        '202': {description: Accepted}

  /jobs/{id}:
    get:
      tags: [Jobs]
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: {type: string}
      responses:
        '200': {description: OK}
  /jobs:
    get:
      tags: [Jobs]
      security: [{ bearerAuth: [] }]
      responses:
        '200': {description: OK}
  /jobs/{id}/events:
    get:
      tags: [Jobs]
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: {type: string}
      responses:
        '200': {description: OK}
  /audit-logs:
    get:
      tags: [Audit]
      security: [{ bearerAuth: [] }]
      responses:
        '200': {description: OK}

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: UUID
  schemas:
    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email: {type: string, format: email}
        password: {type: string}
    LoginResponse:
      type: object
      properties:
        csrf_token: {type: string}
        totp_required: {type: boolean}
        preauth_token: {type: string}
    TOTPVerifyRequest:
      type: object
      required: [preauth_token, code]
      properties:
        preauth_token: {type: string}
        code: {type: string}
    CreateUserRequest:
      type: object
      required: [email, password]
      properties:
        email: {type: string, format: email}
        password: {type: string}
        role:
          type: string
          enum: [admin, user]
    CreateSiteRequest:
      type: object
      required: [name, domain]
      properties:
        name: {type: string}
        domain: {type: string}
        owner_id: {type: string}
